pipeline {
   agent { label 'java-docker-slave'}

   stages {
      stage('Hello') {
         steps {
            echo 'Hello World'
         }
      }

     stage('pwd') {
         steps {
             sh 'pwd'
          }
      }

      stage('check volume') {
         steps {
             sh 'cat /home/jenkins/.m2/repository/data-test'
             sh 'docker'
             sh 'docker info'
             sh 'docker images'
             sh 'docker build -t wenda-test .'

         }

      }

       stage('check volumes and find dind') {
          steps {
              sh 'find /usr/bin/docker'
            }

        }

      stage('docker jar and build') {
         steps {

           sh ' mvn clean package -Dmaven.test.skip=true -e'

           sh ' docker build -t wenda-test .'
         }
      }

      stage('check sonarQube') {

         steps {
           withCredentials([string(credentialsId: 'sonarqube-token', variable: 'TOKEN')]) {
               echo '---------------------------------\n' +
                                          '            Unit test            ' +
                                          '\n---------------------------------'
                sh '''
                     current_commit_id=`git rev-parse --short HEAD`
                '''
           }
         }

      }


      stage('mvn test') {
         steps {
            sh 'mvn clean test'
          }
      }


   }
}
