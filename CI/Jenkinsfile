pipeline {
   agent { label 'java-docker-slave'}

   stages {
      stage('Hello') {
         steps {
            echo 'Hello World'
         }
      }

     stage('pwd') {
         steps {
             sh 'pwd'
          }
      }

      stage('check volume') {
         steps {
             sh 'cat /home/jenkins/.m2/repository/data-test'
         }

      }

       stage('check volumes and find dind') {
          steps {
              sh 'find /usr/bin/docker'
            }

        }

      stage('check sonarQube') {

         steps {
           withCredentials([string(credentialsId: 'sonarqube-token', variable: 'TOKEN')]) {
               echo '---------------------------------\n' +
                                          '            Unit test            ' +
                                          '\n---------------------------------'
                sh '''
                     current_commit_id=`git rev-parse --short HEAD`
                     mvn clean test sonar:sonar \
                     -Dsonar.host.url=http://3.115.71.39 \
                     -Dsonar.login=$TOKEN \
                                        -Dsonar.projectKey=shamu-hrs-company-service \
                                        -Dsonar.projectName=shamu-hrs-company-service \
                                        -Dsonar.projectVersion="$current_commit_id" \
                                        -Dsonar.sources=src/main/java \
                                        -Dsonar.java.binaries=target \
                                        -Dsonar.coverage.jacoco.xmlReportPaths=target/jacoco-output/coverage-report-unit-tests/jacoco.xml \
                                        -Dsonar.tests=target/test-classes
                '''
           }
         }

      }


      stage('mvn test') {
         steps {
            sh 'mvn clean test'
          }
      }


   }
}
